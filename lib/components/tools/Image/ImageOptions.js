import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import React,{useRef,useState}from"react";import Button from"@scaleflex/ui/core/button";import{useAnnotation,useStore}from"../../../hooks";import{FEEDBACK_STATUSES,TOOLS_IDS}from"../../../utils/constants";import{SET_FEEDBACK}from"../../../actions";import HiddenUploadInput from"../../common/HiddenUploadInput";import ImageControls from"./ImageControls";var ADDED_IMG_SPACING_PERCENT=.15,ImageOptions=function(){var a=useState(),b=_slicedToArray(a,2),c=b[0],d=b[1],e=useRef(),f=useStore(),g=f.shownImageDimensions,h=f.dispatch,i=f.adjustments.crop,j=void 0===i?{}:i,k=f.t,l=useAnnotation({name:TOOLS_IDS.IMAGE,opacity:1},!1),m=_slicedToArray(l,3),n=m[0],o=m[1],p=m[2],q=useRef(0),r=function(a){var b=j.width||g.width,c=j.height||g.height,d=j.x||0,e=j.y||0,f=Math.min(1,b/(a.width+a.width*ADDED_IMG_SPACING_PERCENT),c/(a.height+a.height*ADDED_IMG_SPACING_PERCENT));p({image:a,x:d+b/2-a.width*f/2,y:e+c/2-a.height*f/2,width:a.width*f,height:a.height*f})},s=function(a){q.current+=1,q.current===a&&(q.current=0,d(!1))},t=function(a){h({type:SET_FEEDBACK,payload:{feedback:{message:a,status:FEEDBACK_STATUSES.WARNING}}})};return React.createElement(ImageControls,{image:n,saveImage:o,t:k},React.createElement(Button,{className:"FIE_image-tool-add-option",color:"secondary",onClick:c?void 0:function triggerUploadInput(){e.current&&e.current.click()},disabled:c,size:"sm",style:{maxHeight:24}},c?k("importing"):k("addImage")),React.createElement(HiddenUploadInput,{ref:e,onChange:c?void 0:function importImages(a){if(a.target.files){d(!0);var b=[],c=Array.from(a.target.files),e=c.length;if(c.forEach(function(a){if(a.type.startsWith("image/")){var c=new Image;c.onload=function(){r(c),URL.revokeObjectURL(a),s(e)},c.onerror=function(){t(k("uploadImageError")),s(e)},c.src=URL.createObjectURL(a)}else b.push(a.name),s(e)}),0<b.length){var f=1<b.length?k("areNotImages"):k("isNotImage");t("".concat(b.join(", ")," ").concat(f," ").concat(k("toBeUploaded"),"."))}}a.target.value=""},disabled:c,multiple:!0}))};export default ImageOptions;