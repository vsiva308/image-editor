import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import React,{useMemo}from"react";import Menu from"@scaleflex/ui/core/menu";import{SET_CROP,SET_RESIZE,ZOOM_CANVAS}from"../../../actions";import{useStore}from"../../../hooks";import{StyledToolsBarItemButtonLabel}from"../../ToolsBar/ToolsBar.styled";import{DEFAULT_ZOOM_FACTOR,TOOLS_IDS}from"../../../utils/constants";import toPrecisedFloat from"../../../utils/toPrecisedFloat";import getZoomFitFactor from"../../../utils/getZoomFitFactor";import{StyledOpenMenuButton}from"./Crop.styled";import{DEFAULT_CROP_PRESETS}from"./Crop.constants";import CropPresetGroupsList from"./CropPresetGroupsFolder";import CropPresetItem from"./CropPresetItem";var PREFIX_ICONS_DIMENS={height:16,width:16},CropPresetsOption=function(a){var b=a.anchorEl,c=a.onClose,d=useStore(),f=d.dispatch,g=d.t,e=d.adjustments;e=void 0===e?{}:e;var h=e.crop;h=void 0===h?{}:h;var i=h.ratio,j=h.ratioTitleKey,k=h.ratioFolderKey,l=d.shownImageDimensions,m=d.config,n=m[TOOLS_IDS.CROP],o=useMemo(function(){var a=n.presetsItems,b=void 0===a?[]:a,c=n.presetsFolders,d=void 0===c?[]:c;return[].concat(_toConsumableArray(d),_toConsumableArray(DEFAULT_CROP_PRESETS),_toConsumableArray(b))},[n]),p=function(a,b,d){a.stopPropagation();var e={ratio:b,ratioTitleKey:d.ratioTitleKey,ratioGroupKey:d.ratioGroupKey,ratioFolderKey:d.ratioFolderKey};f({type:SET_CROP,payload:e}),n.autoResize&&(f({type:SET_RESIZE,payload:{width:d.width,height:d.height,manualChangeDisabled:d.disableManualResize}}),f({type:ZOOM_CANVAS,payload:{factor:d.width>l.width||d.height>l.height?getZoomFitFactor(l,d):DEFAULT_ZOOM_FACTOR}})),c()};return React.createElement(React.Fragment,null,React.createElement(StyledToolsBarItemButtonLabel,{className:"FIE_crop-tool-label FIE_selected-crop-preset-label"},g(j||"cropTool")),React.createElement(StyledOpenMenuButton,{className:"FIE_crop-presets-opener-button",color:"link",size:"lg"},b?React.createElement(React.Fragment,null,"\u25B4"):React.createElement(React.Fragment,null,"\u25BE")),React.createElement(Menu,{className:"FIE_crop-presets-menu",anchorEl:b,enableOverlay:!0,onClose:c,open:!!b,position:"top"},o.map(function renderPreset(a){var b=a.titleKey,c=a.descriptionKey,d=a.ratio,e=a.width,f=a.height,h=a.groups,j=a.icon,l=a.disableManualResize;return h?React.createElement(CropPresetGroupsList,{key:b,titleKey:b,groups:h,Icon:j,onItemSelect:p,prefixIconDimensions:PREFIX_ICONS_DIMENS,t:g,disableManualResize:l}):React.createElement(CropPresetItem,{key:d,ratio:null!==d&&void 0!==d?d:toPrecisedFloat(e/f),titleKey:b,t:g,description:g(c),Icon:j,isActive:i===(null!==d&&void 0!==d?d:toPrecisedFloat(e/f))&&!k,width:e,height:f,onClick:p,disableManualResize:l})})))};CropPresetsOption.defaultProps={anchorEl:null};export default CropPresetsOption;